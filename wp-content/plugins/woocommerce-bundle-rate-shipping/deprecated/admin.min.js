var ENDA_BUNDLERATE={};!function(t){ENDA_BUNDLERATE.updateLayerNames=function(n){var e=0,a=n.find("tr.rate_row");a.each(function(){t(this).find("input").each(function(){var n=t(this).attr("name").replace(/rates\]\[\d+\]/,"rates]["+e+"]");t(this).attr("name",n)}),e+=1})},ENDA_BUNDLERATE.updateStartCount=function(t){var n,e=t.parents("tr.rate_row").first(),a=e.next();n=t.hasClass("remove_bundle_layer")?parseInt(e.prev().find("input").first().val())+1:parseInt(t.val())+1,a.find("span.start_count").first().text(n)},ENDA_BUNDLERATE.toggleSpecificCountries=function(t){"specific"===t.val()?t.parent().next("div").show():t.parent().next("div").hide()},ENDA_BUNDLERATE.addLayer=function(n){if("disabled"===n.attr("disabled"))return!1;var e=this,a=n.parents("table").first(),i=a.find("tbody tr.rate_row").last(),r={action:"get_new_layer",start_count:parseInt(i.prev().find("input").first().val())+1,cost_input:i.find("input").last().attr("name"),products_input:i.find("input").first().attr("name")};return t.post(ajaxurl,r,function(n){t(n).insertBefore(i),e.updateLayerNames(a)}),!1},ENDA_BUNDLERATE.removeLayer=function(t){var n=t.parents("table").first();return this.updateStartCount(t),t.parents("tr").first().remove(),this.updateLayerNames(n),!1},ENDA_BUNDLERATE.disableAddLayerButton=function(t){var n=t.find("tr.rate_row input").first().val();n&&"0"!==n&&""!==n||t.find(".add_layer").first().attr("disabled",!0)},ENDA_BUNDLERATE.addConfiguration=function(){var n=t("#bundle_rate_configuration > tbody > tr"),e={action:"get_new_configuration_layer",index:n.length};return t.post(ajaxurl,e,function(e){t(e).insertAfter(n.last()),ENDA_BUNDLERATE.init()}),!1},ENDA_BUNDLERATE.init=function(){var n=this;t(".shipping_destination .destination").on("change",function(){n.toggleSpecificCountries(t(this))}).change(),t.isFunction(t.fn.select2)?t("select.chosen_select").select2():t("select.chosen_select").chosen(),t(".shipping_rates table").each(function(){n.disableAddLayerButton(t(this))})},t(document).ready(function(){var n=ENDA_BUNDLERATE;n.init(),t("#bundle_rate_configuration").on("click",".add_layer",function(){return n.addLayer(t(this))}).on("click",".remove_bundle_layer",function(){return n.removeLayer(t(this))}).on("change","input.bundle_rate_products",function(){n.updateStartCount(t(this)),t(this).val()&&"0"!==t(this).val()&&""!==t(this).val()?t(this).parents("table").first().find(".add_layer").first().attr("disabled",!1):t(this).parents("table").first().find(".add_layer").first().attr("disabled",!0)}).on("click",".add_configuration",function(){return n.addConfiguration(t(this))})})}(jQuery);